server:
  port: 8000

spring:
  application:
    name: gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: ${NACOS_NAMESPACE:}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        enabled: true
      config:
        server-addr: localhost:8848
        namespace: ${NACOS_NAMESPACE:}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        file-extension: yml
        enabled: false
        import-check:
          enabled: false
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true
      # 文件上传大小限制配置（WebFlux）
      codec:
        max-in-memory-size: 300MB  # 最大内存缓冲区大小
      httpclient:
        max-header-size: 64KB
        max-connections: 1000
      routes:
        # Auth Service 路由
        - id: auth-service
          uri: lb://auth-service
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1
        # Area Service 路由（地址查询）
        - id: area-service
          uri: lb://auth-service
          predicates:
            - Path=/api/area/**
          filters:
            - StripPrefix=1
        
        # User Post Service 路由 - Post 相关接口
        - id: user-post-service-posts
          uri: lb://user-post-service
          predicates:
            - Path=/api/post/**
          filters:
            - StripPrefix=2
        # User Post Service 路由 - User 和 Comment 相关接口
        - id: user-post-service-others
          uri: lb://user-post-service
          predicates:
            - Path=/api/user/**,/api/comment/**
          filters:
            - StripPrefix=1
        
        # Media Service 路由
        - id: media-service
          uri: lb://media-service
          predicates:
            - Path=/api/media/**
          filters:
            - StripPrefix=1
        
        # AI Service Client 路由 - 音频分离接口
        - id: ai-service-client-separation
          uri: lb://ai-service-client
          predicates:
            - Path=/api/audio/separation/**
          filters:
            - StripPrefix=1
        # AI Service Client 路由 - 任务查询接口
        - id: ai-service-client-task
          uri: lb://ai-service-client
          predicates:
            - Path=/api/audio/task/**
          filters:
            - StripPrefix=1
        # AI Service Client 路由 - 内部进度更新接口（供 Python 调用）
        - id: ai-service-client-internal
          uri: lb://ai-service-client
          predicates:
            - Path=/internal/audio/**
          filters:
            - StripPrefix=1
        # AI Service Client 路由 - 其他 AI 接口（回调等）
        - id: ai-service-client
          uri: lb://ai-service-client
          predicates:
            - Path=/api/ai/**
          filters:
            - StripPrefix=1
      
      # CORS 配置已通过 CorsConfig 类处理

# Actuator 配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    health:
      show-details: always
