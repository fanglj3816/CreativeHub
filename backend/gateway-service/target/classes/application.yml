server:
  port: 8000

spring:
  application:
    name: gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: ${NACOS_NAMESPACE:}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        enabled: true
      config:
        server-addr: localhost:8848
        namespace: ${NACOS_NAMESPACE:}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        file-extension: yml
        enabled: false
        import-check:
          enabled: false
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true
      routes:
        # Auth Service 路由
        - id: auth-service
          uri: lb://auth-service
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1
        
        # User Post Service 路由
        - id: user-post-service
          uri: lb://user-post-service
          predicates:
            - Path=/api/user/**,/api/post/**,/api/comment/**
          filters:
            - StripPrefix=1
        
        # Media Service 路由
        - id: media-service
          uri: lb://media-service
          predicates:
            - Path=/api/media/**
          filters:
            - StripPrefix=1
        
        # AI Service Client 路由
        - id: ai-service-client
          uri: lb://ai-service-client
          predicates:
            - Path=/api/ai/**
          filters:
            - StripPrefix=1
      
      # 全局跨域配置
      globalcors:
        cors-configurations:
          '[/**]':
            # Spring Boot 3 要求：当 allow-credentials 为 true 时不能使用 allowed-origins="*"
            # 使用 allowed-origin-patterns 来支持任意来源
            allowed-origin-patterns: "*"
            allowed-methods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowed-headers: "*"
            allow-credentials: true
            max-age: 3600

# Actuator 配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    health:
      show-details: always
